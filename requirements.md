# ビットコイン・アービトラージ監視アプリ要件定義

## 1. 目的
- 複数取引所間のビットコイン価格差と取引コストを継続的に監視し、実現可能なアービトラージ機会を迅速に検出する。
- 取引実行ロジックを内包しないが、外部のトレーディングシステムへ通知・連携できる状態にする。

## 2. 利用想定・ユーザーストーリー
1. **裁定取引トレーダー**: モバイル通知で即時に価格差を把握し、手動または既存の自動売買システムへ発注する。
2. **ファンド／マーケットメイカー**: ダッシュボードやAPIで閾値を管理し、アラート履歴を研究用途に活用する。
3. **開発運用チーム**: マーケットデータ取得やアラートロジックを監視し、異常を即時に検知する。

## 3. スコープ
- サポート通貨: BTC/JPY, BTC/USD（初期はBTC/JPYにフォーカスし、他通貨ペアは将来的に拡張可能な設計）。
- 取引所: 国内3社（bitFlyer, Coincheck, bitbank）のみをサポートし、KYCや資金移動を国内完結させる。将来は海外取引所を追加できる拡張性を確保。
- 集計レイヤー: 各取引所のオーダーブックまたはベストビッド／アスクを取得し、共通フォーマットに正規化する。
- 表示/通知: Webダッシュボード、メール/Slack/プッシュ通知、Webhook連携。

## 4. 関連システム・外部要件
- 各取引所のREST/WebSocket API（認証要否、レート制限、利用規約）
- カスタマーポータル/Slackワークスペースなど通知先のAPI
- 運用監視基盤（Prometheus, CloudWatchなど）
- セキュリティ/コンプライアンス（KYC要件、各国のライセンス状況、個人情報保護）

## 5. 機能要件
### 5.1 データ収集
- 取引所ごとにティッカー/オーダーブックを定期的にポーリング、またはWebSocketでストリーミング取得。
- 取得頻度: 最低1秒間隔（ターゲット500ms以下）。
- レートリミット管理と自動再接続。

### 5.2 データ正規化・ストレージ
- 取引所ごとの通貨単位・小数点桁を統一。
- リアルタイム計算用にインメモリキャッシュ、履歴分析用に時系列DB（例: TimescaleDB）へ保存。
- 欠損データや異常値の検出・補正ロジック。

### 5.3 価格差計算・フィルタ
- 任意の取引所ペアを選択し、スプレッド=売り価格-買い価格を算出。
- 取引手数料・入出金手数料・為替コストを考慮した純アービトラージ利益を算出。
- 利益率閾値、最低数量、流動性（オーダーブック深さ）によるフィルタリング。

### 5.4 アラート & 通知
- 閾値超過時にリアルタイムアラート送信。
- 通知チャンネルごとのテンプレート、サマリ、詳細リンク。
- 連続アラート抑制、クールダウン設定。

### 5.5 ダッシュボード/可視化
- 取引所ペアごとのリアルタイムスプレッド、過去推移グラフ。
- 閾値・取引所選択などの設定UI。
- アラート履歴、システムヘルス指標を表示。

### 5.6 API/連携
- 外部システムから設定取得・更新、アラート取得ができるREST/GraphQL API。
- WebhookでカスタムシステムへイベントをPOST。

## 6. 非機能要件
- **可用性**: 99.5%以上のサービス稼働率。重要コンポーネントは冗長化。
- **レイテンシ**: データ取得からアラート発火まで1秒以内を目標。
- **スケーラビリティ**: 取引所数×通貨ペア数の増加に比例して水平拡張可能。
- **セキュリティ**: APIキー暗号化保存、RBAC、監査ログ。
- **観測性**: メトリクス、ログ、トレースを収集しSLOを監視。
- **メンテナンス性**: インフラ・コードはInfrastructure as CodeとCI/CDで管理。

## 7. 成功指標 (KPI)
- アラート検出遅延中央値 < 1秒。
- 誤検知率 < 2%（手数料考慮後の実行不可ケース）。
- 通知成功率 99%以上。
- 月次での実行可能アービトラージ数の増加。

## 8. リスク & 制約
- 取引所API制限や仕様変更によるデータ取得停止。
- 為替レート変動や送金遅延により実際の利益が変動。
- 規制変更による一部取引所利用禁止。
- サーバーコスト・API利用料。

## 9. 将来拡張
- 自動発注モジュールとの統合。
- 海外現物/デリバティブ取引所の追加連携。
- デリバティブ・先物・オプションとのクロスマーケット裁定。
- 機械学習による偽アラート削減や期待利益予測。
- ポートフォリオ最適化や資金配分シミュレーション。

## 10. 未決事項
- 初期リリースでサポートする具体的な取引所リスト。
- 運用インフラ（クラウド/オンプレ）とリージョン。
- 利用者認証方式（SSO、APIキー管理）。
- SLA/SLOの正式値とサポート体制。
